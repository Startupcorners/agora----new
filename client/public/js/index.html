<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsletter Builder</title>
    <script src="https://unpkg.com/@grapesjs/studio-sdk/dist/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@grapesjs/studio-sdk-plugins@latest/dist/canvasFullSize/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@grapesjs/studio-sdk-plugins@latest/dist/layoutSidebarButtons/index.umd.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@grapesjs/studio-sdk/dist/style.css"/>
  </head>
  <body>
    <div id="studio-editor" style="height: 100dvh"></div>
    <script>
      // Generate or get project and user IDs from URL params
      const params = new URLSearchParams(window.location.search);
      const projectId = params.get('project_id') || 'project-' + Date.now();
      const userId = params.get('user_id') || 'user-' + Date.now();

      GrapesJsStudioSDK.createStudioEditor({
        root: '#studio-editor',
        licenseKey: '72e811771b3c47c9b37c4b1b8a3b9e9b4dfb57da53c844ffa8b3bb4d27a3a41b',
        theme: 'light',
        project: {
          type: 'email',
          id: projectId
        },
        identity: {
          id: userId
        },
        assets: {
          storageType: 'cloud'
        },
        storage: {
          type: 'cloud',
          autosaveChanges: 100,
          autosaveIntervalMs: 10000
        },
        plugins: [
          StudioSdkPlugins_canvasFullSize.init({}),
          StudioSdkPlugins_layoutSidebarButtons.init({})
        ]
      });

      function sendDataToBubble() {
            if (!editorInstance) {
                alert('Editor is not ready yet.');
                return;
            }

            const html = editorInstance.getHtml();
            const css = editorInstance.getCss();
            const fullHtmlWithCss = `<style>${css}</style>${html}`;

            if (typeof bubble_fn_programDetail === 'function') {
                bubble_fn_programDetail(fullHtmlWithCss);
                console.log('Data sent to Bubble.');
            } else {
                console.error('bubble_fn_programDetail() function not found.');
                alert('Error: Could not send data to Bubble.');
            }
        }
    </script>
  </body>
</html>